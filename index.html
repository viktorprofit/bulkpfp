<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Bulk PFP Customizer</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,500;9..144,600;9..144,700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --bulk-base:#141310;
      --bg-primary:#1B1A14;
      --text-primary:#FFFBEF;
      --text-secondary:#C6B6BA;
      --line:rgba(255,255,255,.08);
      --display-font:"Fraunces",serif;
      --ui-font:system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      color:var(--text-primary);
      background:url("items/bd.png") center center / cover no-repeat fixed;
      font-family:var(--display-font);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    #flakes{
      position:fixed; inset:0;
      width:100vw; height:100vh;
      pointer-events:none;
      z-index:0;
    }

    header.topbar{
      position:sticky; top:0; z-index:100;
      background:#11100Dcc;
      border-bottom:1px solid rgba(255,255,255,.06);
      backdrop-filter:blur(6px);
    }
    .topbar-inner{
      max-width:1200px; margin:0 auto; padding:10px 20px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none}
    .brand img{height:38px; display:block}

    .nav-pills{
      display:flex; align-items:center; gap:24px;
      padding:8px 16px; border-radius:999px;
      background:#151410; border:1px solid rgba(255,255,255,.08);
      box-shadow:inset 0 0 0 1px rgba(0,0,0,.25), 0 1px 0 rgba(255,255,255,.02);
    }
    .nav-pills a{
      text-decoration:none; color:#FFFBEF;
      font-family:var(--display-font); font-weight:600; font-size:14px; letter-spacing:.01em;
      opacity:.92; padding:8px 6px; border-radius:8px;
      transition:opacity .2s ease, background .25s ease;
    }
    .nav-pills a:hover{ opacity:1; background:rgba(255,255,255,.03) }

    .wrap, .topbar-inner{ position:relative; z-index:1 }

    .wrap{
      max-width:1100px; margin:20px auto; padding:0 16px;
      display:grid; gap:20px; grid-template-columns:1fr;
    }
    @media(min-width:1100px){ .wrap{ grid-template-columns:1.2fr .9fr } }

    .stage{
      position:relative;
      background:#0f0f0eaa;
      border:1px solid var(--line);
      border-radius:16px; padding:16px;
      box-shadow:0 30px 80px rgba(0,0,0,.55);
      display:flex; align-items:center; justify-content:center;
    }
    .stage::before{content:"";position:absolute;inset:10px;border:1px solid rgba(255,255,255,.06);border-radius:12px;pointer-events:none}
    .stage::after{content:"";position:absolute;inset:16px;border:1px dashed rgba(255,255,255,.06);border-radius:10px;pointer-events:none}

    canvas#c{
      width:86%;
      background:#0f0f0e;
      border:1px dashed rgba(255,255,255,.08);
      border-radius:12px;
      display:block;
      cursor:grab;
      touch-action:none;
    }

    .panel{
      background:linear-gradient(180deg, rgba(27,26,20,.96), rgba(24,23,18,.94));
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      box-shadow:0 8px 22px rgba(0,0,0,.35);
    }
    .panel + .panel{ margin-top:10px }
    .title{
      display:flex; align-items:center; gap:10px;
      font-family:var(--display-font);
      font-weight:700; font-size:22px; letter-spacing:.01em;
      background:linear-gradient(180deg,#fffbed,#bfb7ab);
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .muted{ color:var(--text-secondary); font-size:12px; font-family:var(--ui-font) }

    .btn{
      appearance:none;
      width:auto;
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      color:#FFFBEF; border:1px solid rgba(255,255,255,.08);
      border-radius:12px; padding:12px 16px; cursor:pointer;
      font-family:var(--display-font); font-weight:700; letter-spacing:.01em;
      background:radial-gradient(circle at 50% 120%, rgba(255,255,255,0.15) 0%, rgba(24,23,18,0.9) 80%);
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.03), 0 1px 1px rgba(0,0,0,.35);
      transition:transform .08s ease, box-shadow .25s ease, background .25s ease;
      text-decoration:none;
    }
    .panel .btn, .bar .btn{ width:100%; }
    .btn:hover{
      background:radial-gradient(circle at 50% 110%, rgba(30,29,24,0.25) 0%, rgba(24,23,18,0.95) 75%);
      box-shadow:0 2px 8px rgba(0,0,0,.5), inset 0 0 0 1px rgba(255,255,255,.05);
    }
    .btn:active{ transform:translateY(1px) }

    input[type="range"]{
      -webkit-appearance:none; width:100%;
      height:5px; background:rgba(255,255,255,.10);
      border-radius:5px; outline:none;
    }
    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none; width:14px; height:14px; border-radius:50%;
      background:#dcd7c5; box-shadow:0 0 6px rgba(255,255,255,.25);
      cursor:pointer; transition:background .2s ease, transform .1s ease;
    }
    input[type="range"]::-webkit-slider-thumb:hover{ background:#fffbe6 }

    .thumbs{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:10px }
    .thumb{
      background:#1f1e1a; border:1px solid var(--line); border-radius:12px;
      min-height:78px; display:flex; align-items:center; justify-content:center;
      cursor:pointer; transition:border-color .25s, box-shadow .25s, background .25s;
    }
    .thumb img{ max-width:88%; object-fit:contain }
    .thumb:hover{ border-color:#dcd7c5; box-shadow:0 0 0 2px rgba(255,255,255,.15) inset, 0 0 16px rgba(255,255,255,.10) }
    .thumb.active{ border-color:#fffbe6; box-shadow:0 0 0 2px rgba(255,255,255,.25) inset, 0 0 22px rgba(255,255,255,.15) }

    .row{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px }
    label{ display:block; margin:6px 0; color:var(--text-secondary); font-size:12px; font-family:var(--ui-font) }
    select{ width:100%; padding:10px 12px; border-radius:10px; background:#201f1b; color:#fff; border:1px solid var(--line) }

    .bar{
      display:flex; justify-content:space-between; gap:12px; margin-top:14px;
    }
    .btn.secondary{
      background:radial-gradient(circle at 50% 120%, rgba(255,255,255,0.05) 0%, rgba(24,23,18,0.9) 80%);
      border:1px solid rgba(255,255,255,.06);
      color:#dcd7c5;
    }
    .btn.secondary:hover{
      background:radial-gradient(circle at 50% 110%, rgba(30,29,24,0.2) 0%, rgba(24,23,18,0.95) 75%);
    }
  </style>
</head>

<body>
  <canvas id="flakes" aria-hidden="true"></canvas>

  <header class="topbar">
    <div class="topbar-inner">
      <a class="brand" href="#"><img src="items/bulk-logo.png" alt="BULK logo"/></a>
      <nav class="nav-pills">
        <a href="https://alphadocs.bulk.trade/" target="_blank">Docs</a>
        <a href="https://t.me/tradebulk" target="_blank">Community</a>
        <a href="https://www.bulk.trade/articles" target="_blank">Articles</a>
      </nav>
      <a class="btn" href="https://discord.gg/bulk" target="_blank">Join Discord</a>
    </div>
  </header>

  <main class="wrap">
    <section class="stage"><canvas id="c" width="900" height="900"></canvas></section>

    <section>
      <div class="panel">
        <div class="title">Upload PFP</div>
        <p class="muted" style="margin:8px 0 12px">PNG / JPG / WEBP — processed locally in your browser.</p>
        <input id="photo" type="file" accept="image/png,image/jpeg,image/webp" style="display:none"/>
        <button id="pickPhoto" class="btn">⬆ Select Image</button>
      </div>

      <div class="panel">
        <div class="title">Select Item</div>
        <div class="thumbs" id="thumbs">
          <button class="thumb" data-mask="cap1"><img src="items/cap-a.png"></button>
          <button class="thumb" data-mask="cap2"><img src="items/cap-b.png"></button>
          <button class="thumb" data-mask="bucket"><img src="items/bucket-hat.png"></button>
        </div>

        <div class="row">
          <div><label for="scale">Scale</label><input id="scale" type="range" min="0.2" max="3" value="1" step="0.01"></div>
          <div><label for="rotate">Rotate (°)</label><input id="rotate" type="range" min="-180" max="180" value="0" step="1"></div>
        </div>

        <div class="row">
          <div><label for="opacity">Opacity</label><input id="opacity" type="range" min="0" max="1" value="1" step="0.01"></div>
          <div>
            <label for="exportSize">Export Size</label>
            <select id="exportSize">
              <option value="orig">Original</option>
              <option value="512">512 × 512</option>
              <option value="1024">1024 × 1024</option>
            </select>
          </div>
        </div>

        <div class="bar">
          <button id="download" class="btn">⬇ Download PNG</button>
          <button id="reset" class="btn secondary">↻ Reset</button>
        </div>
      </div>
    </section>
  </main>

  <script>
  /* falling logos */
  (()=>{const cnv=document.getElementById('flakes');if(!cnv)return;const ctx=cnv.getContext('2d');function resize(){const dpr=Math.min(window.devicePixelRatio||1,2);cnv.width=Math.floor(innerWidth*dpr);cnv.height=Math.floor(innerHeight*dpr);ctx.setTransform(dpr,0,0,dpr,0,0);}resize();addEventListener('resize',resize);const img=new Image();img.src='items/logo-snow.png';const flakes=[];const MAX=10;function spawn(){const s=Math.random()*18+10;flakes.push({x:Math.random()*innerWidth,y:-s,vy:0.4+Math.random()*0.6,vx:(Math.random()-0.5)*0.4,rot:Math.random()*Math.PI*2,vr:(Math.random()-0.5)*0.02,s,alpha:0.2+Math.random()*0.25});}
  function frame(){ctx.clearRect(0,0,innerWidth,innerHeight);if(!img.complete){requestAnimationFrame(frame);return;}while(flakes.length<MAX)spawn();for(let i=flakes.length-1;i>=0;i--){const f=flakes[i];f.x+=f.vx;f.y+=f.vy;f.rot+=f.vr;ctx.save();ctx.globalAlpha=f.alpha;ctx.translate(f.x,f.y);ctx.rotate(f.rot);ctx.drawImage(img,-f.s/2,-f.s/2,f.s,f.s);ctx.restore();if(f.y>innerHeight+40)flakes.splice(i,1);}requestAnimationFrame(frame);}frame();})();

  /* main logic */
  const canvas=document.getElementById('c'),ctx2=canvas.getContext('2d');
  const photoInput=document.getElementById('photo'),pickPhotoBtn=document.getElementById('pickPhoto'),thumbs=document.getElementById('thumbs');
  const scaleInput=document.getElementById('scale'),rotateInput=document.getElementById('rotate'),opacityInput=document.getElementById('opacity');
  const exportSizeSel=document.getElementById('exportSize'),resetBtn=document.getElementById('reset'),dlBtn=document.getElementById('download');
  const state={bgImg:null,capImg:null,cap:{x:0,y:0,w:0,h:0,scale:1,rot:0,alpha:1}};
  const itemPaths={cap1:'items/cap-a.png',cap2:'items/cap-b.png',bucket:'items/bucket-hat.png'};const presets={};for(const[k,src]of Object.entries(itemPaths)){const i=new Image();i.src=src;presets[k]=i;}
  function loadImageFromFile(f){return new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>{const i=new Image();i.onload=()=>res(i);i.onerror=()=>rej();i.src=r.result;};r.readAsDataURL(f);});}
  function fitCanvasToImage(img){const MAX=1400;const k=Math.min(1,MAX/Math.max(img.naturalWidth,img.naturalHeight));canvas.width=img.naturalWidth*k;canvas.height=img.naturalHeight*k;}
  function render(){ctx2.clearRect(0,0,canvas.width,canvas.height);if(state.bgImg)ctx2.drawImage(state.bgImg,0,0,canvas.width,canvas.height);else{ctx2.fillStyle='#0f0f0e';ctx2.fillRect(0,0,canvas.width,canvas.height);}if(state.capImg){const{x,y,w,h,scale,rot,alpha}=state.cap;const cw=w*scale,ch=h*scale,cx=x+cw/2,cy=y+ch/2;ctx2.save();ctx2.translate(cx,cy);ctx2.rotate(rot*Math.PI/180);ctx2.globalAlpha=alpha;ctx2.drawImage(state.capImg,-cw/2,-ch/2,cw,ch);ctx2.restore();ctx2.globalAlpha=1;}}
  pickPhotoBtn.onclick=()=>photoInput.click();
  photoInput.onchange=async()=>{const f=photoInput.files?.[0];if(!f)return;const img=await loadImageFromFile(f);state.bgImg=img;fitCanvasToImage(img);render();};
  thumbs.onclick=e=>{const b=e.target.closest('.thumb');if(!b)return;const k=b.dataset.mask;if(!k)return;state.capImg=presets[k];const iw=state.capImg.width,ih=state.capImg.height;state.cap.w=iw;state.cap.h=ih;state.cap.scale=Math.min(1,canvas.width/iw*0.5);state.cap.x=canvas.width/2-(iw*state.cap.scale)/2;state.cap.y=canvas.height*0.2;document.querySelectorAll('.thumb').forEach(t=>t.classList.remove('active'));b.classList.add('active');render();};
  scaleInput.oninput=()=>{state.cap.scale=parseFloat(scaleInput.value);render();};
  rotateInput.oninput=()=>{state.cap.rot=parseFloat(rotateInput.value);render();};
  opacityInput.oninput=()=>{state.cap.alpha=parseFloat(opacityInput.value);render();};
  resetBtn.onclick=()=>{state.bgImg=null;state.capImg=null;state.cap={x:0,y:0,w:0,h:0,scale:1,rot:0,alpha:1};scaleInput.value="1";rotateInput.value="0";opacityInput.value="1";document.querySelectorAll('.thumb').forEach(t=>t.classList.remove('active'));render();};
  dlBtn.onclick=()=>{const opt=exportSizeSel.value;const size=opt==='orig'?{w:canvas.width,h:canvas.height}:{w:+opt,h:+opt};const off=document.createElement('canvas');off.width=size.w;off.height=size.h;const g=off.getContext('2d');if(state.bgImg)g.drawImage(state.bgImg,0,0,off.width,off.height);else{g.fillStyle='#0f0f0e';g.fillRect(0,0,off.width,off.height);}if(state.capImg){const k=Math.min(off.width/canvas.width,off.height/canvas.height);const{x,y,w,h,scale,rot,alpha}=state.cap;const cw=w*scale*k,ch=h*scale*k;const cx=(x*k)+cw/2,cy=(y*k)+ch/2;g.save();g.translate(cx,cy);g.rotate(rot*Math.PI/180);g.globalAlpha=alpha;g.drawImage(state.capImg,-cw/2,-ch/2,cw,ch);g.restore();}const a=document.createElement('a');a.download='pfp.png';a.href=off.toDataURL('image/png');a.click();};
  render();
  </script>
</body>
</html>
